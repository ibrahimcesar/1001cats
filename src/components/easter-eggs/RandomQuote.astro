---
/**
 * Random Discordian Quote
 * Displays a random quote from the Principia Discordia
 * Refreshes on click
 */

import { getRandomQuote } from '../../utils/discordian-quotes';

const initialQuote = getRandomQuote();
---

<div class="random-quote" id="random-quote">
  <button
    class="quote-refresh"
    id="quote-refresh"
    aria-label="Get another quote"
    title="Click for another quote"
  >
    ðŸ”„
  </button>

  <blockquote class="quote-content">
    <p class="quote-text" id="quote-text">{initialQuote.text}</p>
    <footer class="quote-footer">
      <cite id="quote-author">{initialQuote.author}</cite>
      {initialQuote.source && (
        <span class="quote-source"> â€” {initialQuote.source}</span>
      )}
    </footer>
  </blockquote>
</div>

<style>
  .random-quote {
    position: relative;
    padding: 1.5rem;
    background: var(--bg-secondary);
    border: 2px solid var(--border-color);
    border-radius: 0.75rem;
    margin: 2rem 0;
  }

  .quote-refresh {
    position: absolute;
    top: 1rem;
    right: 1rem;
    width: 2.5rem;
    height: 2.5rem;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--bg-primary);
    border: 2px solid var(--border-color);
    border-radius: 50%;
    font-size: 1.25rem;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .quote-refresh:hover {
    border-color: var(--accent-primary);
    background: var(--accent-primary);
    transform: rotate(180deg);
  }

  .quote-refresh:active {
    transform: rotate(180deg) scale(0.95);
  }

  .quote-content {
    border-left: 4px solid var(--accent-primary);
    padding-left: 1.5rem;
    margin: 0;
    padding-right: 3rem;
  }

  .quote-text {
    font-size: 1.125rem;
    font-style: italic;
    line-height: 1.8;
    color: var(--text-primary);
    margin-bottom: 1rem;
    transition: opacity 0.3s ease;
  }

  .random-quote.loading .quote-text {
    opacity: 0.5;
  }

  .quote-footer {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    flex-wrap: wrap;
  }

  .quote-footer cite {
    font-style: normal;
    font-weight: 600;
    color: var(--accent-primary);
    font-size: 1rem;
  }

  .quote-source {
    font-size: 0.875rem;
    color: var(--text-secondary);
  }

  /* Responsive */
  @media (max-width: 768px) {
    .random-quote {
      padding: 1.25rem;
    }

    .quote-refresh {
      top: 0.75rem;
      right: 0.75rem;
      width: 2rem;
      height: 2rem;
      font-size: 1rem;
    }

    .quote-content {
      padding-right: 2.5rem;
    }

    .quote-text {
      font-size: 1rem;
    }
  }

  /* Accessibility: Respect reduced motion */
  @media (prefers-reduced-motion: reduce) {
    .quote-refresh:hover {
      transform: none;
    }

    .quote-refresh:active {
      transform: scale(0.95);
    }

    .quote-text {
      transition: none;
    }
  }
</style>

<script>
  import { getRandomQuote } from '../../utils/discordian-quotes';

  class RandomQuoteWidget {
    private container: HTMLElement | null;
    private refreshButton: HTMLElement | null;
    private quoteText: HTMLElement | null;
    private quoteAuthor: HTMLElement | null;
    private currentQuote: any;

    constructor() {
      this.container = document.getElementById('random-quote');
      this.refreshButton = document.getElementById('quote-refresh');
      this.quoteText = document.getElementById('quote-text');
      this.quoteAuthor = document.getElementById('quote-author');

      this.init();
    }

    init() {
      this.refreshButton?.addEventListener('click', () => this.refresh());

      // Auto-refresh every 30 seconds (optional)
      // setInterval(() => this.refresh(), 30000);
    }

    async refresh() {
      this.container?.classList.add('loading');

      // Small delay for visual feedback
      await new Promise((resolve) => setTimeout(resolve, 200));

      const quote = getRandomQuote();

      if (this.quoteText) {
        this.quoteText.textContent = quote.text;
      }

      if (this.quoteAuthor) {
        let authorText = quote.author;
        if (quote.source) {
          authorText += ` â€” ${quote.source}`;
        }
        this.quoteAuthor.textContent = authorText;
      }

      this.container?.classList.remove('loading');
    }
  }

  // Initialize
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', () => {
      new RandomQuoteWidget();
    });
  } else {
    new RandomQuoteWidget();
  }

  // Re-initialize on Astro page navigation
  document.addEventListener('astro:page-load', () => {
    new RandomQuoteWidget();
  });
</script>
